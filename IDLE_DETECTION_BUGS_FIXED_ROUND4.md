# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏ –≤ –¥–µ—Ç–µ–∫—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ—è (–†–∞—É–Ω–¥ 4)

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

### üî¥ BUG 22: –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º `isIdle` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `pauseTimeEntryIfIdle` –º—ã –æ–±–Ω–æ–≤–ª—è–ª–∏ `isIdle: true` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ –≤—ã–∑–æ–≤–∞ `pause()`. –ï—Å–ª–∏ `pause()` –Ω–µ —É–¥–∞–≤–∞–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, entry —É–∂–µ –Ω–µ RUNNING), `isIdle` –æ—Å—Ç–∞–≤–∞–ª—Å—è `true`, —Ö–æ—Ç—è entry –Ω–µ –±—ã–ª–∞ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø–∞—É–∑—É. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ—Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –£–±—Ä–∞–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `isIdle` –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `isIdle` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø–∞—É–∑—ã entry
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ `isIdle=true` —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ entry –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø–∞—É–∑—É

### üü° BUG 23: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ `broadcastIdleDetection`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `broadcastIdleDetection` –≤—ã–±—Ä–∞—Å—ã–≤–∞–ª –æ—à–∏–±–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω), —ç—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–∞–¥–µ–Ω–∏—é –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–∞—É–∑—ã, —Ö–æ—Ç—è –ø–∞—É–∑–∞ –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ–π.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω try-catch –≤–æ–∫—Ä—É–≥ –≤—ã–∑–æ–≤–∞ `broadcastIdleDetection`
- –û—à–∏–±–∫–∏ WebSocket –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ warning, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å
- –ü–∞—É–∑–∞ entry —Å—á–∏—Ç–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ–π –¥–∞–∂–µ –µ—Å–ª–∏ WebSocket —Å–æ–±—ã—Ç–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ

### üü° BUG 24: –ü—Ä–æ–±–ª–µ–º–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π `ForbiddenException` –≤ `pause`
**–ü—Ä–æ–±–ª–µ–º–∞:** –í –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫ `pause()` –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª—Å—è —Å–ª—É—á–∞–π, –∫–æ–≥–¥–∞ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è `ForbiddenException` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞). –≠—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ "You can only pause" –≤ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫
- –¢–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ debug (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è)

### üü° BUG 25: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ `update` –ø—Ä–∏ P2002 –≤ `handleHeartbeat`
**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ P2002 (Unique constraint violation) –≤ `handleHeartbeat` –º—ã –¥–µ–ª–∞–ª–∏ `update`, –Ω–æ –µ—Å–ª–∏ `update` —Ç–∞–∫–∂–µ –Ω–µ —É–¥–∞–≤–∞–ª—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞–ø–∏—Å—å –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ –º–µ–∂–¥—É `upsert` –∏ `update`), —ç—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–π –æ—à–∏–±–∫–µ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω try-catch –≤–æ–∫—Ä—É–≥ `update`
- –ï—Å–ª–∏ `update` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç P2025 (Record not found), —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å
- –≠—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç edge case, –∫–æ–≥–¥–∞ –∑–∞–ø–∏—Å—å —É–¥–∞–ª—è–µ—Ç—Å—è –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

### üî¥ BUG 26: Race condition –º–µ–∂–¥—É heartbeat –∏ cron job
**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–ª heartbeat –≤ –º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ cron job –ø—Ä–æ–≤–µ—Ä—è–ª –ø—Ä–æ—Å—Ç–æ—è, –º–æ–≥–ª–∞ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å race condition. Cron job —á–∏—Ç–∞–ª `lastHeartbeat` –≤ –Ω–∞—á–∞–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ heartbeat –º–æ–≥ –æ–±–Ω–æ–≤–∏—Ç—å –µ–≥–æ –¥–æ –ø–∞—É–∑—ã, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø–∞—É–∑–µ.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å `userActivity` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥ double-check
- –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `lastHeartbeat` –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç race condition, –∫–æ–≥–¥–∞ heartbeat –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 27 –±–∞–≥–æ–≤
- **–†–∞—É–Ω–¥ 1:** 7 –±–∞–≥–æ–≤ (race conditions, –ª–æ–≥–∏–∫–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫)
- **–†–∞—É–Ω–¥ 2:** 7 –±–∞–≥–æ–≤ (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- **–†–∞—É–Ω–¥ 3:** 7 –±–∞–≥–æ–≤ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, edge cases, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
- **–†–∞—É–Ω–¥ 4:** 6 –±–∞–≥–æ–≤ (race conditions, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö)

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –±–∞–≥–æ–≤ (–†–∞—É–Ω–¥ 4)

### –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö (1 –±–∞–≥)
- BUG 22: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `isIdle` —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø–∞—É–∑—ã

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (3 –±–∞–≥–∞)
- BUG 23: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ `broadcastIdleDetection`
- BUG 24: –û–±—Ä–∞–±–æ—Ç–∫–∞ `ForbiddenException` –≤ `pause`
- BUG 25: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ `update` –ø—Ä–∏ P2002

### Race Conditions (1 –±–∞–≥)
- BUG 26: –ó–∞—â–∏—Ç–∞ –æ—Ç race condition –º–µ–∂–¥—É heartbeat –∏ cron job

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `isIdle` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø–∞—É–∑—ã
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ WebSocket –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–±—ã—Ç–∏–π
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –ø–∞—É–∑–µ
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —É–¥–∞–ª–µ–Ω–∏—è `UserActivity` –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å race condition: –æ—Ç–ø—Ä–∞–≤–∫–∞ heartbeat –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ç–æ—è

## –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:** `isIdle` —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –û—à–∏–±–∫–∏ WebSocket –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–∞—É–∑—ã
- **–ó–∞—â–∏—Ç–∞ –æ—Ç race conditions:** –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ `userActivity` –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases:** –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–µ–π –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

