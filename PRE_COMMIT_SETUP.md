# Настройка Pre-commit хуков

## Что такое Pre-commit хуки?

Pre-commit хуки — это автоматические проверки, которые выполняются **перед каждым коммитом** в Git. Они помогают:

1. ✅ **Предотвратить коммит кода с ошибками** — проверка линтинга и типов
2. ✅ **Автоматически форматировать код** — единый стиль кода в проекте
3. ✅ **Экономить время** — не нужно запускать проверки вручную
4. ✅ **Улучшить качество кода** — только проверенный код попадает в репозиторий

## Почему это важно?

### Без Pre-commit хуков:

- ❌ Можно закоммитить код с ошибками линтинга
- ❌ Можно закоммитить неправильно отформатированный код
- ❌ CI/CD может падать из-за проблем, которые можно было исправить локально
- ❌ Разные разработчики используют разный стиль кода

### С Pre-commit хуками:

- ✅ Код автоматически форматируется перед коммитом
- ✅ Ошибки линтинга исправляются автоматически (если возможно)
- ✅ CI/CD проходит успешно (меньше проблем)
- ✅ Единый стиль кода во всем проекте

## Что настроено?

### 1. Husky

- **Что это**: Инструмент для управления Git hooks
- **Что делает**: Автоматически запускает проверки перед коммитом

### 2. Lint-staged

- **Что это**: Инструмент для запуска проверок только на измененных файлах
- **Что делает**: Экономит время, проверяя только измененные файлы

### 3. Проверки перед коммитом

#### Для TypeScript файлов (`*.ts`):

- ✅ **ESLint** — проверка и автоматическое исправление ошибок линтинга
- ✅ **Prettier** — автоматическое форматирование кода

#### Для конфигурационных файлов (`*.json`, `*.md`, `*.yml`, `*.yaml`):

- ✅ **Prettier** — автоматическое форматирование

#### Для Prisma схемы (`prisma/schema.prisma`):

- ✅ **Prisma format** — автоматическое форматирование схемы

## Как это работает?

1. Вы делаете `git commit`
2. Husky перехватывает коммит
3. Lint-staged запускает проверки только для измененных файлов
4. Если есть ошибки:
   - Автоматически исправляются (если возможно)
   - Если исправить нельзя — коммит блокируется
5. Если все проверки прошли — коммит выполняется

## Пример работы

```bash
# Вы делаете изменения в файле
$ git add src/auth/auth.service.ts

# Пытаетесь закоммитить
$ git commit -m "fix: исправление бага"

# Pre-commit хук автоматически:
# 1. Запускает ESLint на auth.service.ts
# 2. Автоматически исправляет ошибки (если возможно)
# 3. Запускает Prettier для форматирования
# 4. Если все ОК — коммит выполняется
# 5. Если есть критические ошибки — коммит блокируется
```

## Как пропустить проверки (если нужно)?

Иногда нужно закоммитить без проверок (например, для временных изменений):

```bash
# Пропустить pre-commit хук
git commit --no-verify -m "wip: временные изменения"
```

⚠️ **Внимание**: Используйте `--no-verify` только в крайних случаях!

## Что делать, если проверки не проходят?

1. **ESLint ошибки**: Исправьте ошибки вручную или запустите `npm run lint`
2. **Prettier ошибки**: Запустите `npm run format` для автоматического форматирования
3. **TypeScript ошибки**: Исправьте ошибки типов

## Файлы конфигурации

- `.husky/pre-commit` — скрипт pre-commit хука
- `package.json` → `lint-staged` — конфигурация lint-staged
- `package.json` → `prepare` — автоматическая установка husky при `npm install`

## Проверка работы

Проверьте, что все работает:

```bash
# 1. Сделайте небольшое изменение в любом .ts файле
# 2. Добавьте файл в staging
git add src/app.service.ts

# 3. Попробуйте закоммитить
git commit -m "test: проверка pre-commit"

# Должно автоматически:
# - Запуститься ESLint
# - Запуститься Prettier
# - Если все ОК — коммит выполнится
```

## Преимущества для команды

1. ✅ **Единый стиль кода** — все используют одинаковое форматирование
2. ✅ **Меньше ошибок в CI/CD** — проблемы исправляются локально
3. ✅ **Экономия времени** — не нужно запускать проверки вручную
4. ✅ **Лучшее качество кода** — только проверенный код попадает в репозиторий

## Резюме

Pre-commit хуки — это **важный инструмент** для поддержания качества кода. Они автоматически проверяют и форматируют код перед каждым коммитом, что помогает:

- Предотвратить ошибки
- Поддерживать единый стиль кода
- Экономить время
- Улучшить качество кода

**Рекомендация**: Всегда используйте pre-commit хуки в проектах!
