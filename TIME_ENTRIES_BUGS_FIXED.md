# üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏ –≤ –º–æ–¥—É–ª–µ Time Entries

## –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

### üî¥ BUG 34: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ `create()` - race condition

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `create()` –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –≠—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ race condition, –∫–æ–≥–¥–∞ –ø—Ä–æ–µ–∫—Ç –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º time entry.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤–Ω—É—Ç—Ä—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ entry –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ entry –¥–ª—è –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

### üî¥ BUG 35: –í `resume()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `entry.userId` –∏–∑ —Å—Ç–∞—Ä–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ –≤–º–µ—Å—Ç–æ `currentEntry`

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `resume()` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Activity –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `entry.userId` –∏ `entry.projectId` –∏–∑ –æ–±—ä–µ–∫—Ç–∞ `entry`, –∫–æ—Ç–æ—Ä—ã–π –±—ã–ª –ø–æ–ª—É—á–µ–Ω –¥–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ï—Å–ª–∏ entry –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏, —ç—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –¥–∞–Ω–Ω—ã–º –≤ Activity.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `updatedEntry.userId` –∏ `updatedEntry.projectId` –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ Activity —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### üü° BUG 36: –í `update()` `isIdle` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ RUNNING

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `update()` `isIdle` —Å–±—Ä–∞—Å—ã–≤–∞–ª—Å—è –≤ `false` –≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å entry –Ω–µ –º–µ–Ω—è–ª—Å—è –Ω–∞ `RUNNING`. –≠—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é —Å—Ç–∞—Ç—É—Å–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if (updated.status === 'RUNNING')` –ø–µ—Ä–µ–¥ —Å–±—Ä–æ—Å–æ–º `isIdle`
- `isIdle` —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ —Å—Ç–∞—Ç—É—Å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ `RUNNING`

### üü° BUG 37: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ `broadcastActivity` –∏ `broadcastTimeEntryUpdate`

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `broadcastActivity` –∏–ª–∏ `broadcastTimeEntryUpdate` –≤—ã–±—Ä–∞—Å—ã–≤–∞–ª–∏ –æ—à–∏–±–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω), —ç—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–∞–¥–µ–Ω–∏—é –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è time entry, —Ö–æ—Ç—è —Å–∞–º–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ–π.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –î–æ–±–∞–≤–ª–µ–Ω try-catch –≤–æ–∫—Ä—É–≥ –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤ `broadcastActivity` –∏ `broadcastTimeEntryUpdate`
- –û—à–∏–±–∫–∏ WebSocket –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –∫–∞–∫ warning, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å time entry —Å—á–∏—Ç–∞—é—Ç—Å—è —É—Å–ø–µ—à–Ω—ã–º–∏ –¥–∞–∂–µ –µ—Å–ª–∏ WebSocket —Å–æ–±—ã—Ç–∏–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ

### üü° BUG 38: –í `stop()` –¥–ª—è PAUSED entry –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å duration –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `stop()` –¥–ª—è PAUSED entry –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `entry.duration` –Ω–∞–ø—Ä—è–º—É—é, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å, —á—Ç–æ —ç—Ç–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ï—Å–ª–∏ entry –±—ã–ª–∞ –∏–∑–º–µ–Ω–µ–Ω–∞ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏, —ç—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Ä–∞—Å—á–µ—Ç—É.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- Duration –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `currentEntry.duration` –≤–º–µ—Å—Ç–æ `entry.duration`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ duration –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

### üî¥ BUG 39: –í `update()` –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –º–µ—Ç–æ–¥–µ `update()` –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –≠—Ç–æ –º–æ–≥–ª–æ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ race condition, –∫–æ–≥–¥–∞ –ø—Ä–æ–µ–∫—Ç –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º time entry.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤–Ω—É—Ç—Ä—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tx.user.findFirst` –∏ `tx.project.findFirst` –≤–º–µ—Å—Ç–æ `this.prisma`
- –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ entry –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ

## –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

**–í—Å–µ–≥–æ –Ω–∞–π–¥–µ–Ω–æ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:** 6 –±–∞–≥–æ–≤

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (race conditions):** 2 –±–∞–≥–∞
- **–í–∞–∂–Ω—ã–µ (–ª–æ–≥–∏–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫):** 4 –±–∞–≥–∞

## –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –±–∞–≥–æ–≤

### Race Conditions (2 –±–∞–≥–∞)

- BUG 34: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ `create()`
- BUG 39: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ `update()`

### –õ–æ–≥–∏–∫–∞ (2 –±–∞–≥–∞)

- BUG 35: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ `resume()`
- BUG 36: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–±—Ä–æ—Å `isIdle` –≤ `update()`

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (2 –±–∞–≥–∞)

- BUG 37: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ broadcast
- BUG 38: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç duration –¥–ª—è PAUSED entry

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ time entry –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ time entry –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –∞—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ time entry –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ time entry –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –Ω–∞ RUNNING
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ WebSocket –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ time entry
6. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å—Ç–∞–Ω–æ–≤–∫—É PAUSED entry —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–∞—Å—á–µ—Ç–æ–º duration

## –£–ª—É—á—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π:** –ü—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–µ–∫—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
- **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:** –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å:** –û—à–∏–±–∫–∏ WebSocket –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å time entries
- **–ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤:** Duration –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
