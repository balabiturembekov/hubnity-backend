# üêõ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏ –≤ –º–æ–¥—É–ª–µ App Activity

## ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û: 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–æ–≤

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ë–ê–ì–ò (–ò–°–ü–†–ê–í–õ–ï–ù–´)

### ‚úÖ BUG 1: Race Condition –≤ `create()` - –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ time entry –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –Ω–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –í–ù–ï —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. –ú–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ —Å–æ–∑–¥–∞–Ω–∏–µ–º time entry –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º.

**–°—Ç—Ä–æ–∫–∏:** 29-62 (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏), 107 (—Å–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤–Ω—É—Ç—Ä—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∞—Ç–æ–º–∞—Ä–Ω–æ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tx.appActivity.create` –≤–º–µ—Å—Ç–æ `this.prisma.appActivity.create`

### ‚úÖ BUG 2: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ `createBatch()` - –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Å—Ç—Ä–æ–∫–µ 218 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `this.prisma.appActivity.create` –≤–º–µ—Å—Ç–æ `tx.appActivity.create`. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–µ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø—Ä–æ–±–ª–µ–º–∞–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.

**–°—Ç—Ä–æ–∫–∏:** 202-230

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –ò–∑–º–µ–Ω–µ–Ω —Ñ–æ—Ä–º–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞ callback —Ñ—É–Ω–∫—Ü–∏—é —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `tx`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `tx.appActivity.create` –≤–º–µ—Å—Ç–æ `this.prisma.appActivity.create`
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω–æ –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### ‚úÖ BUG 3: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ `createBatch()` - –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –í batch –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏:

- `timeSpent` (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ, –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤)
- –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç (isNaN)
- `endTime > startTime`
- –ü—É—Å—Ç–æ–π `appName` –ø–æ—Å–ª–µ trim

**–°—Ç—Ä–æ–∫–∏:** 203-229

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏ –ø–µ—Ä–µ–¥ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `timeSpent >= 0` –∏ `timeSpent <= 86400`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ –¥–∞—Ç (isNaN)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ `endTime > startTime`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç–æ–≥–æ `appName` –ø–æ—Å–ª–µ trim
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –î–û —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üü° –í–ê–ñ–ù–´–ï –ë–ê–ì–ò

### ‚úÖ BUG 4: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–∏–ø –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ - –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Å—Ç—Ä–æ–∫–∞—Ö 335 –∏ 339 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `throw new Error()` –≤–º–µ—Å—Ç–æ `BadRequestException`. –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ 500 –æ—à–∏–±–∫–µ –≤–º–µ—Å—Ç–æ 400.

**–°—Ç—Ä–æ–∫–∏:** 335, 339

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –ó–∞–º–µ–Ω–µ–Ω–æ `throw new Error()` –Ω–∞ `throw new BadRequestException()`
- –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `BadRequestException` –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
- –¢–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π HTTP —Å—Ç–∞—Ç—É—Å 400

### ‚úÖ BUG 5: –ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ `create()` - –ò–°–ü–†–ê–í–õ–ï–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:** –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 64-104), —á—Ç–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–°—Ç—Ä–æ–∫–∏:** 29-62 (—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è), 64-104 (–≤–∞–ª–∏–¥–∞—Ü–∏—è)

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –î–û —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ë–î

### BUG 6: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –¥–∞—Ç –≤ batch

**–ü—Ä–æ–±–ª–µ–º–∞:** –í batch –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ:

- `startTime` –∏ `endTime` —è–≤–ª—è—é—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–∞—Ç–∞–º–∏
- `endTime > startTime`

**–°—Ç—Ä–æ–∫–∏:** 210-216

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏.

### BUG 7: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤ batch

**–ü—Ä–æ–±–ª–µ–º–∞:** –í batch –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (24 —á–∞—Å–∞ = 86400 —Å–µ–∫—É–Ω–¥).

**–°—Ç—Ä–æ–∫–∏:** 203-229

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `timeSpent <= 86400` –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏.

## üü¢ –ú–ï–õ–ö–ò–ï –ë–ê–ì–ò

### BUG 8: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –ø—É—Å—Ç–æ–π appName –≤ batch

**–ü—Ä–æ–±–ª–µ–º–∞:** –í batch –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ `appName` –Ω–µ –ø—É—Å—Ç–æ–π –ø–æ—Å–ª–µ trim.

**–°—Ç—Ä–æ–∫–∏:** 204

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `sanitizedAppName.length > 0`.

### BUG 9: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –≤ batch

**–ü—Ä–æ–±–ª–µ–º–∞:** –í batch –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ `timeSpent >= 0`.

**–°—Ç—Ä–æ–∫–∏:** 203-229

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `timeSpent >= 0` –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–ø–∏—Å–∏.

### BUG 10: –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å –±–æ–ª—å—à–∏–º–∏ batch –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –∑–∞–ø–∏—Å–µ–π (–¥–æ 100) –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–µ –ë–î.

**–°—Ç—Ä–æ–∫–∏:** 202-230

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞—Ç—á–∏–Ω–≥ –∏–ª–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π.
